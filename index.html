<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width" , initial-scale="1.0">
  <title>Rock Paper Scissors</title>
  <!-- Bootstrap -->
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
  <!-- Fonts -->

</head>

<style media="screen">
  body {
    margin: 2em 0 0;
  }

  .box {
    border: 1px solid black;
    height: 200px;
    margin: 0.5em;
    padding: 1em;
  }

  .chat-display {
    border: 1px solid black;
    height: 200px;
  }

  .col-center {
    float: none;
    margin-right: auto;
    margin-left: auto;
  }
</style>

<body>
  <div class="text-center">
    <h1>Rock Paper Scissors</h1>

    <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 col-center">
      <form class="">
        <div class="form-group">
          <label>Enter Player Name:</label>
          <input type="text" class="form-control" id="player-input">
          <input id="player-input-button" type="submit">
        </div>
      </form>
    </div>
  </div>

  <div class="container">
    <div class="row">
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">

      </div>
    </div>

    <div class="row">
      <div id="player-one-box" class="col-xs-3 col-sm-3 col-md-3 col-lg-3 box">

      </div>

      <div id="player-results-box" class="col-xs-3 col-sm-3 col-md-3 col-lg-3 box">

      </div>

      <div id="player-two-box" class="col-xs-3 col-sm-3 col-md-3 col-lg-3 box">

      </div>
    </div>

    <div class="row">
      <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
        <form class="" action="index.html" method="post">
          <div class="form-group">
            <div class="chat-display"></div>
            <input type="text" class="form-control" placeholder="Enter a message...">
            <input type="submit" name="submit">
          </div>
        </form>
      </div>
    </div>

  </div>


</body>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
<!-- Bootstrap JS -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
<!--Firebase-->
<script src="https://www.gstatic.com/firebasejs/4.1.3/firebase.js"></script>
<!-- Js -->
<script type="text/javascript">
  var config = {
    apiKey: "AIzaSyCHJWoeCMbyK6mmhQlxCPIQwPzCZXSa_bU",
    authDomain: "rock-paper-scissors-game-b4885.firebaseapp.com",
    databaseURL: "https://rock-paper-scissors-game-b4885.firebaseio.com",
    projectId: "rock-paper-scissors-game-b4885",
    storageBucket: "",
    messagingSenderId: "977002967515"
  };
  firebase.initializeApp(config);

  let database = firebase.database();
  let playerNumber = 0;
  let turn = 0;
  let playerOneWins = 0;
  let playerOneLosses = 0;
  let playerTwoWins = 0;
  let playerTwoLosses = 0;

  function addPlayer(id) {
    database.ref("/players/" + id).set({
      name: $("#player-input").val().trim(),
      wins: 0,
      losses: 0
    })
  }

  $(document).ready(function() {

    $(document).on('click', '#player-input-button', function() {
      event.preventDefault();
      if (playerNumber !== 2) {
        playerNumber++;
        console.log("Player added: " + playerNumber);
        addPlayer(playerNumber);
        $('#player-input').val('');
      } else {
        alert("Already two players!");
      }
    });

    database.ref("/players").on("child_added", function() {
        if (playerNumber === 2) {

          turn = 1;
          let playerOneChoice;
          let playerTwoChoice;

          // turn one begins --------------------------------------------------
          database.ref("/turn").set(turn);

          promptPlayerInput('one');
          $("#player-one-box").css("border-color", "yellow");

          $(document).on('click', '.one-rps-button', function() {
            var choice = $(this).val();
            database.ref("/players/1/choice").set(choice);
            playerOneChoice = choice;
            $("#player-one-box")
              .css("border-color", "black")
              .html(`<h3>${choice}</h3>`);
          });
          turn++;
          database.ref("/turn").set(turn);

          // turn two begins --------------------------------------------------
          promptPlayerInput('two');
          $("#player-two-box").css("border-color", "yellow");

          $(document).on('click', '.two-rps-button', function() {
            $(document).off('click', '.one-rps-button');
            var choice = $(this).val();
            playerTwoChoice = choice;
            database.ref("/players/2/choice").set(choice);
            $("#player-two-box")
              .css("border-color", "black")
              .html(`<h3>${choice}</h3>`);
          });
          turn++;
          database.ref("/turn").set(turn);

          // turn three begins ------------------------------------------------
          $(document).off('click', '.two-rps-button');
          var answer = comparePlayerInputs(playerOneChoice, playerTwoChoice);
          if (answer === 'one') {
            playerOneWins++;
            playerTwoLosses++;
            database.ref("/players/1/wins").update(playerOneWins);
            database.ref("/players/2/losses").update(playerTwoLosses);

          } else if (answer === 'two') {
            playerOneLosses++;
            playerTwoWins++;
            database.ref("/players/1/losses").update(playerOneLosses);
            database.ref("/players/2/wins").update(playerTwoWins);
          }
          database.ref("/players/1/choice").remove();
          database.ref("/players/2/choice").remove();
          turn = 0;
          database.ref("/turn").set(turn);
        }

      }
    });

  function comparePlayerInputs(a, b) {

    switch (a === "Rock") {
      case (b === "Rock"):
        return 'tie';
        break;
      case (b === "Scissors"):
        return 'one';
        break;
      case (b === "Paper"):
        return 'two';
        break;
    }

    switch (a === "Paper") {
      case (b === "Rock"):
        return 'one';
        break;
      case (b === "Scissors"):
        return 'two';
        break;
      case (b === "Paper"):
        return 'tie';
        break;
    }

    switch (a === "Scissors") {
      case (b === "Rock"):
        return 'two';
        break;
      case (b === "Scissors"):
        return 'tie';
        break;
      case (b === "Paper"):
        return 'one';
        break;
    }

  };

  function promptPlayerInput(num) {
    var buttonGroup =
      `
    <div class="button-group">
      <button class="rock-button ${num}-rps-button btn btn-mg btn-default">Rock</button>
      <button class="paper-button ${num}-rps-button btn btn-mg btn-default">Paper</button>
      <button class="scissors-button ${num}-rps-button btn btn-mg btn-default">Scissors</button>
    </div>
    `;
    $('#player-' + num + '-box').append(buttonGroup);
    return;
  }

  });

  // beforeunload event to detect reloading of page
</script>

</html>
